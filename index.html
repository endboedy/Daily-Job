<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Monitoring Equipment</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  h2 { margin-bottom: 10px; }
  table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
  th, td {
    border: 1px solid #000;
    padding: 4px;
    text-align: left;
  }
  th { background: #f2f2f2; }
  .category-row {
    background: #ffd966;
    font-weight: bold;
  }
  .btn { margin: 5px; padding: 4px 8px; cursor: pointer; }
  .small { width: 100px; }
  .medium { width: 180px; }
  .large { width: 250px; }
  .action-btn { margin-right: 5px; cursor: pointer; color: blue; }
</style>
</head>
<body>

<h2>Monitoring Equipment</h2>

<button id="saveBtn" class="btn">Save JSON</button>
<input type="file" id="loadFile" class="btn">

<input type="text" id="searchBox" placeholder="Cari data..." style="width:100%; margin:10px 0;">

<div id="tableContainer"></div>

<script>
const categories = ["Loading", "OHT", "Support", "Plant"]; 
let data = {
  "Loading": [],
  "OHT": [],
  "Support": [],
  "Plant": []
};

// render table
function renderTable() {
  const container = document.getElementById("tableContainer");
  container.innerHTML = "";

  categories.forEach(cat => {
    let html = `
      <table>
        <tr class="category-row"><td colspan="9">${cat}</td></tr>
        <tr>
          <th class="small">Equipment</th>
          <th class="small">Actual Down Time</th>
          <th class="small">LTR Status</th>
          <th class="large">Component Code</th>
          <th class="large">Action Plan</th>
          <th class="medium">Location</th>
          <th class="small">BD Aging Days</th>
          <th class="small">Est RFU</th>
          <th class="small">Aksi</th>
        </tr>
    `;

    data[cat].forEach((row, i) => {
      html += `
        <tr>
          <td>${row.equipment}</td>
          <td>${row.downTime}</td>
          <td>${row.ltr}</td>
          <td>${row.compCode}</td>
          <td>${row.action}</td>
          <td>${row.loc}</td>
          <td>${row.bdAging}</td>
          <td>${row.rfu}</td>
          <td>
            <span class="action-btn" onclick="editRow('${cat}', ${i})">Edit</span>
            <span class="action-btn" onclick="deleteRow('${cat}', ${i})">Delete</span>
          </td>
        </tr>`;
    });

    html += `
      <tr><td colspan="9" style="text-align:center;">
        <button class="btn" onclick="addRow('${cat}')">+ Tambah Baris</button>
      </td></tr>
      </table>
    `;

    container.innerHTML += html;
  });
}

function addRow(cat) {
  data[cat].push({
    equipment: "", downTime: "", ltr: "", compCode: "",
    action: "", loc: "", bdAging: "", rfu: ""
  });
  editRow(cat, data[cat].length - 1);
}

function editRow(cat, idx) {
  const row = data[cat][idx];
  const table = document.getElementById("tableContainer");
  const rows = table.getElementsByTagName("table")[categories.indexOf(cat)].rows;
  const tr = rows[idx+2]; // offset (header + category row)
  tr.innerHTML = `
    <td><input value="${row.equipment}"></td>
    <td><input type="date" value="${row.downTime}"></td>
    <td><input value="${row.ltr}"></td>
    <td><input value="${row.compCode}"></td>
    <td><input value="${row.action}"></td>
    <td><input value="${row.loc}"></td>
    <td>${row.bdAging}</td>
    <td><input type="date" value="${row.rfu}"></td>
    <td>
      <span class="action-btn" onclick="saveRow('${cat}', ${idx}, this)">Save</span>
      <span class="action-btn" onclick="renderTable()">Cancel</span>
    </td>
  `;
}

function saveRow(cat, idx, el) {
  const inputs = el.closest("tr").querySelectorAll("input");
  const down = inputs[1].value, rfu = inputs[7].value;
  const bdAging = (down && rfu) ? 
    Math.ceil((new Date(rfu) - new Date(down)) / (1000*60*60*24)) : "";

  data[cat][idx] = {
    equipment: inputs[0].value,
    downTime: down,
    ltr: inputs[2].value,
    compCode: inputs[3].value,
    action: inputs[4].value,
    loc: inputs[5].value,
    bdAging: bdAging,
    rfu: rfu
  };
  renderTable();
}

function deleteRow(cat, idx) {
  data[cat].splice(idx, 1);
  renderTable();
}

// save JSON
document.getElementById("saveBtn").addEventListener("click", () => {
  const blob = new Blob([JSON.stringify(data)], {type: "application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "monitoring.json";
  a.click();
});

// load JSON
document.getElementById("loadFile").addEventListener("change", function(e){
  const file = e.target.files[0];
  const reader = new FileReader();
  reader.onload = () => {
    data = JSON.parse(reader.result);
    renderTable();
  };
  reader.readAsText(file);
});

// pertama kali
renderTable();
</script>

</body>
</html>
